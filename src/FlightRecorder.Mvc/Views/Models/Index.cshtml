@model FlightRecorder.Mvc.Models.ListModelsViewModel

@{
    ViewData["Title"] = "Models";
}

<p class="text-center font-weight-bold">
    <span style="font-size: 1.2rem">
        Aircraft Models
    </span>
    <br />
    <small class="text-muted">
        <em>
            Manage the aircraft models for aircraft registered in the log
        </em>
    </small>
</p>

<div class="container-fluid">
    <div class="row">
        <div class="col">
            <strong>Manufacturer</strong>
            <div class="input-group">
                @Html.DropDownListFor(m => m.ManufacturerId, Model.Manufacturers, new { @class = "form-control" })
            </div>
        </div>
    </div>
    <hr/>
    <div id="ModelsList">
        @if (Model.ManufacturerId > 0)
        {
            await Html.PartialAsync("List", Model.Models);
        }
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $("#ManufacturerId").change(function () {
            var manufacturerId = $("#ManufacturerId").val();
            if (manufacturerId > 0) {
                var route = "/Models/List?manufacturerId=" + manufacturerId;
                $('html, body').css("cursor", "wait");
                $.ajax({
                    url: route,
                    method: "GET",
                    dataType: "html",
                    cache: false,
                    success: function (result) {
                        $("#ModelsList").html(result);
                        $('html, body').css("cursor", "auto");
                    },
                    error: function (xhr, status, error) {
                        var errorMessage = xhr.status + ': ' + xhr.statusText
                        $("#ModelsList").html(errorMessage);
                        $('html, body').css("cursor", "auto");
                    }
                });
            } else {
                $("#ModelsList").html("");
            }
        });
    });
</script>
